DROP VIEW `trans_view_stats`;
create view trans_view_stats as
select `a`.`trxtime` AS `trxtime`,`b`.`companyid` AS `companyid`,`c`.`officename` AS `officename`,
`a`.`agentid` AS `agentid`,
(select `trans_accounts`.`username` AS `username` from `trans_accounts` where (`trans_accounts`.`id` = `a`.`agentid`)) AS `username`,
`a`.`siteid` AS `siteid`,
(select `trans_sites`.`sitename` AS `sitename` from `trans_sites` where (`trans_sites`.`id` = `a`.`siteid`)) AS `sitename`,
`a`.`typeid` AS `typeid`,(select `trans_types`.`typename` AS `typename` from `trans_types` where (`trans_types`.`id` = `a`.`typeid`)) AS `typename`,
(select `trans_types`.`price` AS `price` from `trans_types` where (`trans_types`.`id` = `a`.`typeid`)) AS `price`,
`a`.`raws` AS `raws`,`a`.`uniques` AS `uniques`,`a`.`chargebacks` AS `chargebacks`,
`a`.`signups` AS `signups`,`a`.`sales_number` AS `sales_number`,
(`a`.`sales_number` * (select `trans_types`.`price` AS `price` from `trans_types` where (`trans_types`.`id` = `a`.`typeid`))) AS `payouts`,
(a.sales_number * (select earning from trans_types where (trans_types.id = a.typeid))) as earnings
from ((`trans_stats` `a` join `trans_agents` `b`) join `trans_companies` `c`) where ((`a`.`agentid` = `b`.`id`) and (`b`.`companyid` = `c`.`id`));