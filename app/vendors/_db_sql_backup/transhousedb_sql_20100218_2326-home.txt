-- phpMyAdmin SQL Dump
-- version 3.1.3.1
-- http://www.phpmyadmin.net
--
-- 主机: localhost
-- 生成日期: 2010 年 02 月 18 日 15:26
-- 服务器版本: 5.1.33
-- PHP 版本: 5.2.9

SET SQL_MODE="NO_AUTO_VALUE_ON_ZERO";

--
-- 数据库: `zcakephp`
--

-- --------------------------------------------------------

--
-- 表的结构 `trans_accounts`
--

CREATE TABLE IF NOT EXISTS `trans_accounts` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `username` varchar(64) NOT NULL,
  `password` varbinary(48) NOT NULL,
  `originalpwd` varchar(48) NOT NULL,
  `role` tinyint(4) NOT NULL COMMENT '0-admin,1-company,2-agent',
  PRIMARY KEY (`id`),
  UNIQUE KEY `username` (`username`)
) ENGINE=MyISAM  DEFAULT CHARSET=gbk AUTO_INCREMENT=62 ;

--
-- 导出表中的数据 `trans_accounts`
--

INSERT INTO `trans_accounts` (`id`, `username`, `password`, `originalpwd`, `role`) VALUES
(29, 'y', '3f6f1cd54374559e85af79e90b3df18c907ee83f', 'y', 2),
(27, 'cp', 'a1bf7c38c7e6a57507a3c79bb21c98bb4e7e5d50', 'cp', 1),
(28, 'com00', '4171c4f58178184112920abe3c61993276b0f2df', '00', 1),
(30, 't', '96dbfbbd7ad8d2fe84459896b14a526f6c5a0fa6', 't', 2),
(31, 'admin', '7d2afefd81656a31b6b0631aa7df598c9fd43f0d', 'a', 0),
(32, 'a', '7d2afefd81656a31b6b0631aa7df598c9fd43f0d', 'a', 2),
(33, 'cp02', 'b33b46737b6ba42d2d0f867b8ac13d1acaf83a4e', '02', 1),
(34, 'testi', '321cecf227064b5b3df7e9ad3fe616d51f049e75', 'i', 1),
(35, 'u', '3a41f1791de5c8523f0c8d2b642f080f44cf0c3f', 'u', 2),
(36, 'nobody', '08d813e1621840344523003169a29457732a95d0', 'nobody', 2),
(37, 'testii', 'ca3b02e87b7695b76fb812b0b7497eeebdb95932', 'ii', 1);

-- --------------------------------------------------------

--
-- 表的结构 `trans_agents`
--

CREATE TABLE IF NOT EXISTS `trans_agents` (
  `id` int(11) unsigned NOT NULL,
  `name` varchar(64) NOT NULL,
  `paytoname` varchar(64) NOT NULL,
  `keystring` varchar(64) DEFAULT NULL,
  `companyid` int(11) NOT NULL,
  UNIQUE KEY `id` (`id`)
) ENGINE=MyISAM DEFAULT CHARSET=gbk;

--
-- 导出表中的数据 `trans_agents`
--

INSERT INTO `trans_agents` (`id`, `name`, `paytoname`, `keystring`, `companyid`) VALUES
(30, 'tt', 'ttt', NULL, 28),
(29, 'yy', 'yyy', NULL, 28),
(32, 'aa', 'aaa', NULL, 27),
(35, 'uu', 'uuu', NULL, 33),
(36, 'everybody', 'whoiam', NULL, 34);

-- --------------------------------------------------------

--
-- 表的结构 `trans_checkups`
--

CREATE TABLE IF NOT EXISTS `trans_checkups` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `agentid` int(11) NOT NULL,
  `type` tinyint(4) NOT NULL COMMENT '0-means join, 1-means multiple-signup,2-means conversion,3-means chargeback',
  `times` int(11) NOT NULL COMMENT 'count of multiple-signups when type = 1, otherwise it equals to 1 of course',
  `starttime` datetime NOT NULL,
  `endtime` datetime NOT NULL,
  `checktime` datetime NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=MyISAM  DEFAULT CHARSET=gbk AUTO_INCREMENT=27 ;

--
-- 导出表中的数据 `trans_checkups`
--

INSERT INTO `trans_checkups` (`id`, `agentid`, `type`, `times`, `starttime`, `endtime`, `checktime`) VALUES
(1, 29, 0, 1, '2010-01-19 00:00:00', '2010-01-19 00:00:00', '2010-02-14 00:00:00'),
(2, 29, 2, 1, '2010-01-11 11:16:00', '2010-01-11 11:16:00', '2010-02-14 00:00:00'),
(3, 30, 0, 1, '2009-10-12 11:17:00', '2009-10-12 11:17:00', '2010-02-14 00:00:00'),
(4, 30, 2, 1, '2009-12-23 11:17:00', '2009-12-23 11:17:00', '2010-02-14 00:00:00'),
(5, 35, 1, 2, '2009-11-25 19:50:00', '2010-01-01 19:50:00', '2010-02-14 00:00:00'),
(6, 35, 1, 2, '2010-01-12 19:51:00', '2010-01-23 20:10:00', '2010-02-14 00:00:00'),
(7, 36, 2, 1, '2010-01-15 21:41:00', '2010-01-15 21:41:00', '2010-02-14 00:00:00');

-- --------------------------------------------------------

--
-- 表的结构 `trans_clicks`
--

CREATE TABLE IF NOT EXISTS `trans_clicks` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `agentid` int(11) NOT NULL,
  `clicktime` datetime NOT NULL,
  `reflink` varchar(512) CHARACTER SET armscii8 COLLATE armscii8_bin NOT NULL DEFAULT 'n/a',
  `memcreditcard` varchar(16) CHARACTER SET armscii8 COLLATE armscii8_bin NOT NULL COMMENT 'one credit car could only behave one member, so if two or more signups with one credit card then there should be a multible signup',
  `checkupid` int(11) NOT NULL COMMENT 'match the id in the table trans_checkups',
  PRIMARY KEY (`id`)
) ENGINE=MyISAM  DEFAULT CHARSET=gbk AUTO_INCREMENT=24 ;

--
-- 导出表中的数据 `trans_clicks`
--

INSERT INTO `trans_clicks` (`id`, `agentid`, `clicktime`, `reflink`, `memcreditcard`, `checkupid`) VALUES
(1, 29, '2010-01-19 00:00:00', 'www.signupsucceed.com', '', 1),
(2, 29, '2010-01-08 00:00:00', 'http://www.google.com', '', 0),
(3, 29, '2010-01-11 11:16:29', 'www.aconversion.com', '', 2),
(4, 30, '2009-10-12 11:17:20', 'www.signupsucceed.com', '', 3),
(5, 30, '2009-12-23 11:17:49', 'www.aconversion.com', '', 4),
(6, 32, '2010-01-08 14:27:06', 'www.nbc.com', '', 0),
(7, 32, '2010-01-06 14:27:22', 'www.nbc.com', '', 0),
(8, 35, '2010-01-01 19:50:31', 'www.signupsucceed.com', '1000000123456789', 5),
(9, 35, '2010-01-15 19:50:39', 'n/a', '', 0),
(10, 35, '2009-11-25 19:50:54', 'www.signupsucceed.com', '1000000123456789', 5),
(11, 35, '2010-01-12 19:51:08', 'www.signupsucceed.com', '1000000000000000', 6),
(12, 35, '2010-01-23 20:10:03', 'www.signupsucceed.com', '1000000000000000', 6),
(13, 36, '2010-01-15 21:41:24', 'www.aconversion.com', '', 7),
(14, 36, '2010-01-15 21:41:32', 'www.discovery.com', '', 0),
(15, 29, '2010-01-15 21:19:53', 'n/a', '', 0),
(16, 29, '2010-01-15 21:20:09', 'affiliates.com', '', 0),
(17, 30, '2010-01-15 22:42:59', 'n/a', '', 0),
(18, 30, '2010-01-15 22:43:14', 'ngc.com', '', 0);

-- --------------------------------------------------------

--
-- 表的结构 `trans_companies`
--

CREATE TABLE IF NOT EXISTS `trans_companies` (
  `id` int(11) unsigned NOT NULL,
  `contactname` varchar(64) DEFAULT NULL,
  `payeename` varchar(64) NOT NULL COMMENT 'for the company',
  `payeeaddr1` varchar(128) DEFAULT NULL,
  `payeeaddr2` varchar(128) DEFAULT NULL,
  `payeecity` varchar(64) DEFAULT NULL,
  `payeestate` varchar(64) DEFAULT NULL,
  `payeezipcode` varchar(64) DEFAULT NULL,
  `payeecountry` varchar(64) DEFAULT NULL,
  `payeeemail` varchar(128) DEFAULT NULL,
  `payouttype` tinyint(4) DEFAULT NULL COMMENT '0-pay by check, 1-pay by webstern uion, 2-pay by wire',
  `pps` decimal(8,2) NOT NULL DEFAULT '10.00',
  `paymentinfo` text,
  `agentnotes` text,
  PRIMARY KEY (`id`),
  UNIQUE KEY `payeename` (`payeename`)
) ENGINE=MyISAM DEFAULT CHARSET=gbk;

--
-- 导出表中的数据 `trans_companies`
--

INSERT INTO `trans_companies` (`id`, `contactname`, `payeename`, `payeeaddr1`, `payeeaddr2`, `payeecity`, `payeestate`, `payeezipcode`, `payeecountry`, `payeeemail`, `payouttype`, `pps`, `paymentinfo`, `agentnotes`) VALUES
(27, 'cp', 'cp', 'cp', '2', 'c', 's', 'z', 'c', 'e', 1, 10.00, 'i', 'ii'),
(28, 'com zero zero', 'com00 to pay', 'com00 addr1', 'com00 addr2', '', '', '', '', '', 0, 10.00, '', ''),
(33, 'cp02', 'CP 02', 'CP02 ADDR1', 'CP02 ADDR2', '', '', '', '', '', 0, 10.00, '', ''),
(34, 'test i', 'TEST I', 'test addr 1', 'marilyn', 'philipine', 'ca', '20111', '', '', 0, 10.00, '', ''),
(37, 'TESTII', 'Test II', 'addr1', 'addr2', 'NYC', 'NYS', '0', 'NY', 'NY@NY.C', 0, 10.00, 'Something about the payment...', 'Attentions, guys...');

-- --------------------------------------------------------

--
-- 表的结构 `trans_tickets`
--

CREATE TABLE IF NOT EXISTS `trans_tickets` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `subscriptionid` int(11) NOT NULL,
  `datesubmitted` date NOT NULL,
  `datereplied` date NOT NULL,
  `credited` tinyint(4) NOT NULL,
  `curmessage` varchar(256) NOT NULL,
  `submitted` tinyint(4) NOT NULL,
  `datejoin` date NOT NULL,
  `joincookieid` varchar(64) NOT NULL,
  `clientusername` varchar(64) NOT NULL,
  `clientpassword` varchar(64) NOT NULL,
  `clientip` varchar(64) NOT NULL,
  `referringurl` varchar(512) NOT NULL,
  `agentkey` varchar(128) NOT NULL,
  `companykey` varchar(128) NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=MyISAM DEFAULT CHARSET=gbk AUTO_INCREMENT=1 ;

--
-- 导出表中的数据 `trans_tickets`
--


-- --------------------------------------------------------

--
-- Stand-in structure for view `trans_view_agents`
--
CREATE TABLE IF NOT EXISTS `trans_view_agents` (
`id` int(11) unsigned
,`username` varchar(64)
,`originalpwd` varchar(48)
,`companyid` int(11) unsigned
,`payeename` varchar(64)
,`name` varchar(64)
,`paytoname` varchar(64)
,`keystring` varchar(64)
);
-- --------------------------------------------------------

--
-- Stand-in structure for view `trans_view_clicks`
--
CREATE TABLE IF NOT EXISTS `trans_view_clicks` (
`clickdate` date
,`clicktime` time
,`agentid` int(11)
,`reflink` varchar(512)
,`checkupid` int(11)
,`action` int(4)
);
-- --------------------------------------------------------

--
-- Stand-in structure for view `trans_view_companies`
--
CREATE TABLE IF NOT EXISTS `trans_view_companies` (
`id` int(11) unsigned
,`username` varchar(64)
,`originalpwd` varchar(48)
,`payeename` varchar(64)
,`contactname` varchar(64)
);
-- --------------------------------------------------------

--
-- Stand-in structure for view `trans_view_payouts`
--
CREATE TABLE IF NOT EXISTS `trans_view_payouts` (
`id` int(11) unsigned
,`payeename` varchar(64)
,`contactname` varchar(64)
,`payeeaddr1` varchar(128)
,`payeeaddr2` varchar(128)
,`payeecity` varchar(64)
,`payeestate` varchar(64)
,`payeezipcode` varchar(64)
,`payeecountry` varchar(64)
,`payeeemail` varchar(128)
,`payouttype` tinyint(4)
,`paymentinfo` text
,`pps` decimal(8,2)
,`username` varchar(64)
,`originalpwd` varchar(48)
,`action` int(11)
,`clickdate` date
);
-- --------------------------------------------------------

--
-- Stand-in structure for view `trans_view_stats`
--
CREATE TABLE IF NOT EXISTS `trans_view_stats` (
`id` int(11)
,`agentid` int(11)
,`agentname` varchar(64)
,`companyid` int(11)
,`payeename` varchar(64)
,`raws` varchar(512)
,`uniques` varchar(512)
,`joins` int(11)
,`multisignups` int(11)
,`conversions` int(11)
,`chargebacks` int(11)
,`starttime` datetime
,`endtime` datetime
);
-- --------------------------------------------------------

--
-- Structure for view `trans_view_agents`
--
DROP TABLE IF EXISTS `trans_view_agents`;

CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `trans_view_agents` AS select `trans_agents`.`id` AS `id`,`trans_accounts`.`username` AS `username`,`trans_accounts`.`originalpwd` AS `originalpwd`,`trans_companies`.`id` AS `companyid`,`trans_companies`.`payeename` AS `payeename`,`trans_agents`.`name` AS `name`,`trans_agents`.`paytoname` AS `paytoname`,`trans_agents`.`keystring` AS `keystring` from ((`trans_agents` join `trans_companies`) join `trans_accounts`) where ((`trans_agents`.`id` = `trans_accounts`.`id`) and (`trans_agents`.`companyid` = `trans_companies`.`id`));

-- --------------------------------------------------------

--
-- Structure for view `trans_view_clicks`
--
DROP TABLE IF EXISTS `trans_view_clicks`;

CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `trans_view_clicks` AS select cast(`trans_clicks`.`clicktime` as date) AS `clickdate`,cast(`trans_clicks`.`clicktime` as time) AS `clicktime`,`trans_clicks`.`agentid` AS `agentid`,`trans_clicks`.`reflink` AS `reflink`,`trans_clicks`.`checkupid` AS `checkupid`,(case when `trans_clicks`.`checkupid` in (select `trans_checkups`.`id` AS `id` from `trans_checkups`) then (select `trans_checkups`.`type` AS `type` from `trans_checkups` where (`trans_checkups`.`id` = `trans_clicks`.`checkupid`)) else NULL end) AS `action` from `trans_clicks`;

-- --------------------------------------------------------

--
-- Structure for view `trans_view_companies`
--
DROP TABLE IF EXISTS `trans_view_companies`;

CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `trans_view_companies` AS select `trans_companies`.`id` AS `id`,`trans_accounts`.`username` AS `username`,`trans_accounts`.`originalpwd` AS `originalpwd`,`trans_companies`.`payeename` AS `payeename`,`trans_companies`.`contactname` AS `contactname` from (`trans_companies` join `trans_accounts`) where (`trans_companies`.`id` = `trans_accounts`.`id`);

-- --------------------------------------------------------

--
-- Structure for view `trans_view_payouts`
--
DROP TABLE IF EXISTS `trans_view_payouts`;

CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `trans_view_payouts` AS select `trans_companies`.`id` AS `id`,`trans_companies`.`payeename` AS `payeename`,`trans_companies`.`contactname` AS `contactname`,`trans_companies`.`payeeaddr1` AS `payeeaddr1`,`trans_companies`.`payeeaddr2` AS `payeeaddr2`,`trans_companies`.`payeecity` AS `payeecity`,`trans_companies`.`payeestate` AS `payeestate`,`trans_companies`.`payeezipcode` AS `payeezipcode`,`trans_companies`.`payeecountry` AS `payeecountry`,`trans_companies`.`payeeemail` AS `payeeemail`,`trans_companies`.`payouttype` AS `payouttype`,`trans_companies`.`paymentinfo` AS `paymentinfo`,`trans_companies`.`pps` AS `pps`,`trans_accounts`.`username` AS `username`,`trans_accounts`.`originalpwd` AS `originalpwd`,`trans_view_clicks`.`action` AS `action`,`trans_view_clicks`.`clickdate` AS `clickdate` from (((`trans_view_clicks` join `trans_companies`) join `trans_accounts`) join `trans_agents`) where ((`trans_view_clicks`.`agentid` = `trans_agents`.`id`) and (`trans_agents`.`companyid` = `trans_companies`.`id`) and (`trans_companies`.`id` = `trans_accounts`.`id`)) union select `trans_companies`.`id` AS `id`,`trans_companies`.`payeename` AS `payeename`,`trans_companies`.`contactname` AS `contactname`,`trans_companies`.`payeeaddr1` AS `payeeaddr1`,`trans_companies`.`payeeaddr2` AS `payeeaddr2`,`trans_companies`.`payeecity` AS `payeecity`,`trans_companies`.`payeestate` AS `payeestate`,`trans_companies`.`payeezipcode` AS `payeezipcode`,`trans_companies`.`payeecountry` AS `payeecountry`,`trans_companies`.`payeeemail` AS `payeeemail`,`trans_companies`.`payouttype` AS `payouttype`,`trans_companies`.`paymentinfo` AS `paymentinfo`,`trans_companies`.`pps` AS `pps`,`trans_accounts`.`username` AS `username`,`trans_accounts`.`originalpwd` AS `originalpwd`,NULL AS `NULL`,NULL AS `NULL` from (`trans_companies` join `trans_accounts`) where ((`trans_companies`.`id` = `trans_accounts`.`id`) and (not(`trans_companies`.`id` in (select distinct `trans_agents`.`companyid` AS `companyid` from (`trans_agents` join `trans_view_clicks`) where (`trans_view_clicks`.`agentid` = `trans_agents`.`id`)))));

-- --------------------------------------------------------

--
-- Structure for view `trans_view_stats`
--
DROP TABLE IF EXISTS `trans_view_stats`;

CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `trans_view_stats` AS select `trans_checkups`.`id` AS `id`,`trans_checkups`.`agentid` AS `agentid`,`trans_agents`.`name` AS `agentname`,`trans_agents`.`companyid` AS `companyid`,`trans_companies`.`payeename` AS `payeename`,NULL AS `raws`,NULL AS `uniques`,(case when (`trans_checkups`.`type` = 0) then `trans_checkups`.`times` else NULL end) AS `joins`,(case when (`trans_checkups`.`type` = 1) then `trans_checkups`.`times` else NULL end) AS `multisignups`,(case when (`trans_checkups`.`type` = 2) then `trans_checkups`.`times` else NULL end) AS `conversions`,(case when (`trans_checkups`.`type` = 3) then `trans_checkups`.`times` else NULL end) AS `chargebacks`,`trans_checkups`.`starttime` AS `starttime`,`trans_checkups`.`endtime` AS `endtime` from ((`trans_checkups` join `trans_agents`) join `trans_companies`) where ((`trans_checkups`.`agentid` = `trans_agents`.`id`) and (`trans_agents`.`companyid` = `trans_companies`.`id`)) union select `trans_clicks`.`id` AS `id`,`trans_clicks`.`agentid` AS `agentid`,`trans_agents`.`name` AS `agentname`,`trans_agents`.`companyid` AS `companyid`,`trans_companies`.`payeename` AS `payeename`,`trans_clicks`.`reflink` AS `raws`,`trans_clicks`.`reflink` AS `uniques`,NULL AS `joins`,NULL AS `multisignups`,NULL AS `conversions`,NULL AS `chargebacks`,`trans_clicks`.`clicktime` AS `starttime`,`trans_clicks`.`clicktime` AS `endtime` from ((`trans_clicks` join `trans_agents`) join `trans_companies`) where ((`trans_clicks`.`agentid` = `trans_agents`.`id`) and (`trans_agents`.`companyid` = `trans_companies`.`id`));
